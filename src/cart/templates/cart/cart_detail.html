{% extends "base.html" %}
{% load cart_extras %}
{% load i18n %}

{% block title %}{% trans "Корзина" %}{% endblock %}
{% block content %}

  <h1>{% trans "Корзина" %}</h1>
  {% if messages %}
    <ul>
      {% for m in messages %}<li>{{ m }}</li>{% endfor %}
    </ul>
  {% endif %}

  {% if items %}
    <table class="table">
      <thead>
        <tr>
          <th>{% trans "Товар" %}</th>
          <th>{% trans "Цена" %}</th>
          <th>{% trans "Кол-во" %}</th>
          <th>{% trans "Сумма" %}</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for it in items %}
        <tr>
          <td>
            <a href="/p/{{ it.product.base_slug }}/">{{ it.product.translations.title|default:it.product }}</a>
          </td>
          <td>{{ it.unit_price_snapshot|money }} {{ it.product.currency }}</td>
          <td>
            <form action="/cart/update/{{ it.id }}/" method="post" style="display:flex;gap:6px;align-items:center;">
              {% csrf_token %}
              <input type="number" min="0" name="qty" value="{{ it.qty }}" style="width:70px;">
              <button class="btn secondary" type="submit">{% trans "OK" %}</button>
            </form>
          </td>
          <td><b>{{ it.unit_price_snapshot|mul:it.qty }} {{ it.product.currency }}</b></td>
          <td>
            <form action="/cart/remove/{{ it.id }}/" method="post">
              {% csrf_token %}
              <button class="btn secondary" type="submit">{% trans "Удалить" %}</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <p style="text-align:right;font-size:18px;">{% trans "Итого" %}: <span class="price">{{ subtotal }} GEL</span></p>
    <p style="text-align:right;">
      <a class="btn" href="/checkout/">{% trans "Оформить заказ" %}</a>
    </p>
  {% else %}
    <div class="empty-state">
      <div class="empty-icon" aria-hidden="true">
        <svg width="26" height="26" viewBox="0 0 24 24" fill="none">
          <path d="M6 6h15l-1.5 9h-12L6 6Z" stroke="currentColor" stroke-width="2" fill="none"/>
          <circle cx="9" cy="20" r="1.5" fill="currentColor"/>
          <circle cx="17" cy="20" r="1.5" fill="currentColor"/>
        </svg>
      </div>
      <h2 style="margin:0 0 6px;">{% trans "Тут пусто" %}</h2>
      <p class="muted" style="margin:0 0 10px;">{% trans "Добавьте товары из каталога, чтобы оформить заказ." %}</p>
      <a class="btn" href="{% url 'catalog:product_list' %}">{% trans "Перейти в каталог" %}</a>
    </div>
  {% endif %}
{% endblock %}
