{% load i18n cart_extras %}
<div class="order-card" id="card-{{ it.id }}" hx-swap-oob="true">
  <div style="display: flex; gap: 16px; align-items: flex-start;">
    {% if it.product.image %}<img src="{{ it.product.image.url }}" alt="" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px; border: 1px solid var(--border);">{% endif %}
    <div style="flex: 1;">
      <a href="/p/{{ it.product.base_slug }}/" style="font-weight: 600; color: var(--text); line-height: 1.3;">{{ it.product.translations.title|default:it.product }}</a>
      <div style="font-size: 14px; color: var(--text-secondary); margin-top: 4px;">{{ it.unit_price_snapshot|money }} {{ it.product.currency }} / {% trans "шт." %}</div>
    </div>
  </div>
  <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 12px;">
    <input type="number" min="1" class="qty-input" name="qty" value="{{ it.qty }}"
           hx-post="{% url 'cart:update_item' %}"
           hx-vals='{"item_id":"{{ it.id }}"}'
           hx-include="this"
           hx-trigger="change, keyup delay:400ms">
    <div style="text-align: right;">
      <div class="price" style="font-size: 20px;">{{ it.unit_price_snapshot|mul:it.qty }} {{ it.product.currency }}</div>
      <form action="/cart/remove/{{ it.id }}/" method="post" style="margin-top: 4px;">
        {% csrf_token %}
        <button type="submit" style="background:none; border:none; color:var(--danger); font-size:13px; cursor:pointer; padding: 4px;">{% trans "Удалить" %}</button>
      </form>
    </div>
  </div>
</div>