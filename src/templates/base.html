{% load static i18n %}
<!doctype html>
<html lang="{{ request.LANGUAGE_CODE|default:'ka' }}">
  <head>
    <meta charset="utf-8">
    <title>{% block title %}iZugdidi — Used iPhones{% endblock %}</title>
    {% load static i18n %}
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{% static 'css/site.css' %}">
  </head>
  <body>
    <header class="site-header">
  <div class="container header-row">
    <a class="logo" href="/">iZugdidi</a>

    <nav class="nav">
      <a href="{% url 'catalog:product_list' %}">{% trans "Каталог" %}</a>
      <a href="{% url 'cms:contacts' %}">{% trans "Контакты" %}</a>

      <a title="{% trans 'Корзина' %}"
         href="{% url 'cart:detail' %}"
         class="icon-link cart-link"
         aria-label="{% trans 'Корзина' %}">
        <svg class="icon" width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M6 6h15l-1.5 9h-12L6 6Z" stroke="currentColor" stroke-width="2" fill="none"/>
          <circle cx="9" cy="20" r="1.5" fill="currentColor"/>
          <circle cx="17" cy="20" r="1.5" fill="currentColor"/>
        </svg>
        {% include "cart/_badge.html" %}
      </a>

      {% if request.user.is_authenticated %}
        <a title="{% trans 'Мои заказы' %}" href="{% url 'users:my_orders' %}" class="icon-link" aria-label="{% trans 'Мои заказы' %}">
          <svg class="icon" width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="2"/>
            <path d="M4 20c2-4 6-6 8-6s6 2 8 6" stroke="currentColor" stroke-width="2" fill="none"/>
          </svg>
        </a>
        <form action="{% url 'logout' %}" method="post" style="display:inline;">
          {% csrf_token %}
          <button type="submit" title="{% trans 'Выйти' %}" class="icon-link" aria-label="{% trans 'Выйти' %}" style="background:none;border:none;padding:0;cursor:pointer;">
            <svg class="icon" width="22" height="22" viewBox="0 0 24 24" aria-hidden="true" fill="none">
              <path d="M14 12H4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M11 9l-3 3 3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M18 4h-6a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </form>
      {% else %}
        <a title="{% trans 'Войти' %}" href="{% url 'login' %}" class="icon-link" aria-label="{% trans 'Войти' %}">
          <svg class="icon" width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M10 12h8" stroke="currentColor" stroke-width="2"/>
            <path d="M13 9l3 3-3 3" stroke="currentColor" stroke-width="2" fill="none"/>
            <path d="M6 4h6a2 2 0 0 1 2 2v3" stroke="currentColor" stroke-width="2" fill="none"/>
          </svg>
        </a>
        <a href="{% url 'users:signup' %}" class="nav-link-text">{% trans "Регистрация" %}</a>
      {% endif %}

      <form action="{% url 'set_language' %}" method="post" class="lang-form">
        {% csrf_token %}
        <input type="hidden" name="next" value="{{ request.get_full_path }}">
        <select name="language" onchange="this.form.submit()">
          <option value="ka"{% if request.LANGUAGE_CODE == 'ka' %} selected{% endif %}>ქართული</option>
          <option value="en"{% if request.LANGUAGE_CODE == 'en' %} selected{% endif %}>English</option>
        </select>
      </form>
    </nav>

    <!-- КНОПКА БУРГЕРА ВНУТРИ header-row -->
    <button class="burger" aria-label="Menu" aria-expanded="false" aria-controls="mobile-menu"
            onclick="(function(btn){var m=document.getElementById('mobile-menu');var o=m.classList.toggle('open');btn.setAttribute('aria-expanded', o);})(this)">
      <span></span><span></span><span></span>
    </button>
  </div>

  <div id="mobile-menu" class="mobile-menu">
    <a href="{% url 'catalog:product_list' %}">{% trans "Каталог" %}</a>
    <a href="{% url 'cms:contacts' %}">{% trans "Контакты" %}</a>
    {% if request.user.is_authenticated %}
      <a href="{% url 'users:my_orders' %}">{% trans "Мои заказы" %}</a>
      <a href="{% url 'logout' %}">{% trans "Выйти" %}</a>
    {% else %}
      <a href="{% url 'login' %}">{% trans "Войти" %}</a>
      <a href="{% url 'users:signup' %}">{% trans "Регистрация" %}</a>
    {% endif %}
  </div>
</header>


    <main class="container">
      {% block content %}{% endblock %}
    </main>

    <footer class="site-footer">
      <div class="container">
        © {{ now|date:"Y" }} iZugdidi — {% trans "поддержанные iPhone в Зугдиди" %}
      </div>
    </footer>
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
  <div id="toast" class="toast" hx-ext="class-tools"></div>
<script>
  (function(){
    var t = document.getElementById('toast');
    window.showToast = function(msg){
      if(!t) return;
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(function(){ t.classList.remove('show'); t.textContent=''; }, 2000);
    }
    document.body.addEventListener('htmx:afterRequest', function(e){
      var m = e.detail.xhr.getResponseHeader('X-Toast');
      if(m){ showToast(m); }
    });
  })();
</script>

  </body>
</html>
